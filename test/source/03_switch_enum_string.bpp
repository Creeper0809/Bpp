// Covers: enum, switch int/enum/string, default (stress)
// Expect exit code: 0

import std.str;

enum Color {
    Red,
    Green,
    Blue,
}

enum Status {
    OK = 10,
    Error = 20,
    Pending,
}

enum Perm {
    Read = 1 << 0,
    Write = 1 << 1,
    Execute = 1 << 2,
    ReadWrite = (1 << 0) | (1 << 1),
    All = ((1 << 0) | (1 << 1)) | (1 << 2),
}

func classify(v: i64) -> i64 {
    switch (v) {
        case 0:
            return 10;
        case 1:
            return 20;
        default:
            return 30;
    }
}

func main(argc: i64, argv: *u64) -> i64 {
    // Import

    // Setup
    var color: i64 = Color_Green;
    var out: i64 = 0;
    var status_sum: i64 = 0;

    // Execution
    if (classify(0) != 10) { return 1; }
    if (classify(1) != 20) { return 2; }
    if (classify(7) != 30) { return 3; }

    switch (color) {
        case Color_Red:
            out = 1;
            break;
        case Color_Green:
            out = 2;
            break;
        case Color_Blue:
            out = 3;
            break;
        default:
            out = 4;
    }
    if (out != 2) { return 4; }

    switch ("ok") {
        case "ok":
            out = 11;
            break;
        case "fail":
            out = 22;
            break;
        default:
            out = 33;
    }
    if (out != 11) { return 5; }

    // Edge: enum with explicit values
    status_sum = Status_OK + Status_Error + Status_Pending;
    if (status_sum != 51) { return 6; }

        // Stress: 반복 분기 및 문자열 스위치
        var acc: i64 = 0;
        for (var i: i64 = -1; i < 4; i = i + 1) {
            acc = acc + classify(i);
        }
        if (acc != 120) { return 7; }

        var s: *u8 = 0;
        var s_sum: i64 = 0;
        for (var k: i64 = 0; k < 3; k = k + 1) {
            if (k == 0) { s = "ok"; }
            if (k == 1) { s = "fail"; }
            if (k == 2) { s = "none"; }
            switch (s) {
                case "ok":
                    s_sum = s_sum + 11;
                    break;
                case "fail":
                    s_sum = s_sum + 22;
                    break;
                default:
                    s_sum = s_sum + 33;
            }
        }
        if (s_sum != 66) { return 8; }

    // Complex: mixed enum/int/string switch combinations
    var mix_sum: i64 = 0;
    for (var i: i64 = 0; i < 6; i = i + 1) {
        var st: i64 = 0;
        if ((i & 1) == 0) { st = Status_OK; }
        if ((i & 1) == 1) { st = Status_Error; }
        switch (st) {
            case Status_OK:
                mix_sum = mix_sum + 3;
                break;
            case Status_Error:
                mix_sum = mix_sum + 5;
                break;
            default:
                mix_sum = mix_sum + 7;
        }
        switch (i) {
            case 0:
                mix_sum = mix_sum + 1;
                break;
            case 3:
                mix_sum = mix_sum + 2;
                break;
            default:
                mix_sum = mix_sum + 0;
        }
        var label: *u8 = 0;
        if (i < 2) { label = "low"; }
        if ((i >= 2) && (i < 5)) { label = "mid"; }
        if (i >= 5) { label = "high"; }
        switch (label) {
            case "low":
                mix_sum = mix_sum + 10;
                break;
            case "mid":
                mix_sum = mix_sum + 20;
                break;
            default:
                mix_sum = mix_sum + 30;
        }
    }
    if (mix_sum != 137) { return 9; }

    // Enum bitwise operations with scoped member syntax.
    var perm_mask: i64 = Perm.Read | Perm.Write;
    if (perm_mask != Perm.ReadWrite) { return 10; }
    if ((perm_mask & Perm.Write) == 0) { return 11; }
    perm_mask = perm_mask ^ Perm.Read;
    if (perm_mask != Perm.Write) { return 12; }
    perm_mask = perm_mask << 1;
    if (perm_mask != 4) { return 13; }
    perm_mask = perm_mask >> 1;
    if (perm_mask != Perm.Write) { return 14; }
    var all_mask: i64 = Perm.ReadWrite | Perm.Execute;
    if (all_mask != Perm.All) { return 15; }

    // Assertion
    return 0;
}
