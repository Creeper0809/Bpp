// Covers: core language extensions failure diagnostics suite

//=== CASE 115_lambda_capture_forbidden_fail
// Expect compile fail: 1
// Expect error contains: lambda captures are not supported yet

func main() -> u64 {
    var cap: u64 = 7;
    var f: u64 = func (x: u64) -> u64 { x + cap };
    return f(1);
}
//=== END

//=== CASE 125_statement_annotation_target_fail
// Expect compile fail: 1
// Expect error contains: statement annotation target must be variable declaration

func main() -> u64 {
    @[x]
    return 0;
}
//=== END

//=== CASE 126_top_level_annotation_target_fail
// Expect compile fail: 1
// Expect error contains: annotation target must be function or variable declaration

@[x]
import std.io;

func main() -> u64 {
    return 0;
}
//=== END

//=== CASE 116_named_argument_unknown_param_fail
// Expect compile fail: 1
// Expect error contains: unknown named argument

func addx(a: u64, b: u64 = 1) -> u64 {
    return a + b;
}

func main() -> u64 {
    return addx(a: 1, c: 2);
}
//=== END

//=== CASE 117_missing_required_argument_fail
// Expect compile fail: 1
// Expect error contains: missing required argument

func must_have_a_case117(a: u64, b: u64 = 9) -> u64 {
    return a + b;
}

func main() -> u64 {
    return must_have_a_case117(b: 1);
}
//=== END

//=== CASE 118_variadic_must_be_last_fail
// Expect compile fail: 1
// Expect error contains: variadic parameter must be the last parameter

func bad(...rest: u64, tail: u64) -> u64 {
    return rest + tail;
}

func main() -> u64 {
    return bad(1, 2);
}
//=== END

//=== CASE 119_variadic_cannot_have_default_fail
// Expect compile fail: 1
// Expect error contains: variadic parameter cannot have default value

func bad(...rest: u64 = 1) -> u64 {
    return rest;
}

func main() -> u64 {
    return bad();
}
//=== END

//=== CASE 120_throw_outside_try_fail
// Expect compile fail: 1
// Expect error contains: throw can only be used inside try

func main() -> u64 {
    throw 1;
    return 0;
}
//=== END

//=== CASE 121_match_wildcard_mixed_with_values_fail
// Expect compile fail: 1
// Expect error contains: wildcard '_' cannot be mixed with explicit case values

func main() -> u64 {
    match (1) {
        case 1, _:
            return 1;
        }
    }
    return 0;
}
//=== END

//=== CASE 122_try_requires_handler_fail
// Expect compile fail: 1
// Expect error contains: try statement requires catch and/or finally block

func main() -> u64 {
    try {
        var x: u64 = 1;
        x = x + 1;
    }
    return 0;
}
//=== END

//=== CASE 123_named_args_unknown_param_on_instance_method_fail
// Expect compile fail: 1
// Expect error contains: unknown named argument

struct BoxFail {
    public v: u64;
}

impl BoxFail {
    public func set(self: *BoxFail, a: u64, b: u64) -> u64 {
        self.v = a + b;
        return self.v;
    }
}

func main() -> u64 {
    var b: BoxFail = BoxFail { 0 };
    return b.set(c: 2, a: 1);
}
//=== END

//=== CASE 129_multiple_entry_functions_fail
// Expect compile fail: 1
// Expect error contains: multiple @[entry] functions are not allowed

@[entry]
func run_a() -> u64 {
    return 0;
}

@[entry]
func run_b() -> u64 {
    return 0;
}
//=== END

//=== CASE 130_decorator_signature_mismatch_fail
// Expect compile fail: 1
// Expect error contains: decorator parameter list must match target function after the first parameter

func bad_decorator(next: u64, x: i64) -> u64 {
    return next((u64)x);
}

@[bad_decorator]
func target_signature(x: u64) -> u64 {
    return x;
}

func main() -> u64 {
    return target_signature(1);
}
//=== END

//=== CASE 131_entry_annotation_requires_zero_params_fail
// Expect compile fail: 1
// Expect error contains: @[entry] function must not declare parameters

@[entry]
func bad_entry(argc: u64) -> u64 {
    return argc;
}
//=== END

//=== CASE 132_enum_member_assignment_forbidden_fail
// Expect compile fail: 1
// Expect error contains: Cannot assign to enum member constant

enum EnumAssignFail {
    A = 1,
}

func main() -> u64 {
    EnumAssignFail.A = 3;
    return 0;
}
//=== END
