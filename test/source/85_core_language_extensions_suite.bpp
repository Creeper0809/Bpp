// Covers: core language extensions success suite

//=== CASE 108_bool_and_signed_int_primitives
func main() -> u64 {
    var b_true: bool = true;
    var b_false: bool = false;
    var x8: i8 = (i8)120;
    var x16: i16 = (i16)30000;
    var x32: i32 = (i32)2000000000;

    if (b_true == 0) { return 1; }
    if (b_false != 0) { return 2; }
    if ((i64)x8 != 120) { return 3; }
    if ((i64)x16 != 30000) { return 4; }
    if ((i64)x32 != 2000000000) { return 5; }

    return 0;
}
//=== END

//=== CASE 124_annotation_on_function_and_variable_decls
@[config]
var G_ANNOTATED: u64 = 40;

struct AnnBox {
}

impl AnnBox {
    @[trace]
    public static func add(a: u64, b: u64) -> u64 {
        return a + b;
    }
}

@[feature]
func sum_with_annotation(a: u64, b: u64) -> u64 {
    @[hot]
    var local_sum: u64 = a + b;
    return local_sum;
}

func main() -> u64 {
    var out: u64 = sum_with_annotation(G_ANNOTATED, 2);
    if (out != 42) { return 1; }
    if (AnnBox.add(1, 1) != 2) { return 2; }
    return 0;
}
//=== END

//=== CASE 109_default_named_and_variadic_direct_call
func add3(a: u64, b: u64 = 7, c: u64 = 11) -> u64 {
    return a + b + c;
}

func variadic_head_sum(head: u64, ...rest: u64) -> u64 {
    return head + rest;
}

func main() -> u64 {
    var a: u64 = add3(1);
    var b: u64 = add3(1, c: 100, b: 10);
    var c: u64 = add3(a: 5, c: 1);

    if (a != 19) { return 10; }
    if (b != 111) { return 11; }
    if (c != 13) { return 12; }

    var v0: u64 = variadic_head_sum(9);
    var v1: u64 = variadic_head_sum(9, 4);
    var v2: u64 = variadic_head_sum(9, 4, 88, 99);

    if (v0 != 9) { return 20; }
    if (v1 != 13) { return 21; }
    if (v2 != 13) { return 22; }

    return 0;
}
//=== END

//=== CASE 110_lambda_non_capture_success
func main() -> u64 {
    var f: u64 = func (x: u64) -> u64 { x + 2 };
    var g: u64 = func (x: u64, y: u64) -> u64 { x * y };

    var a: u64 = f(40);
    var b: u64 = g(6, 7);

    if (a != 42) { return 1; }
    if (b != 42) { return 2; }
    return 0;
}
//=== END

//=== CASE 135_lambda_capture_success
func make_adder(base: u64) -> u64 {
    var add: u64 = func (x: u64) -> u64 { x + base };
    return add;
}

func main() -> u64 {
    var add5: u64 = make_adder(5);
    if (add5(37) != 42) { return 1; }
    return 0;
}
//=== END

//=== CASE 111_match_alias_with_wildcard
func classify(v: u64) -> u64 {
    match (v) {
        case 1:
            return 10;
        case 2:
            return 20;
        case _:
            return 99;
    }
}

func main() -> u64 {
    if (classify(1) != 10) { return 1; }
    if (classify(2) != 20) { return 2; }
    if (classify(777) != 99) { return 3; }
    return 0;
}
//=== END

//=== CASE 112_try_catch_finally_throw_success
func main() -> u64 {
    var x: u64 = 0;
    try {
        x = x + 1;
        throw 123;
        x = x + 100;
    } catch {
        x = x + 10;
    } finally {
        x = x + 1000;
    }

    if (x != 1011) { return 1; }
    return 0;
}
//=== END

//=== CASE 113_constructor_default_and_named_args
struct PointEx {
    public x: u64;
    public y: u64;
}

impl PointEx {
    public constructor(x: u64, y: u64 = 5) {
        self.x = x;
        self.y = y;
    }
}

func main() -> u64 {
    var p0: PointEx = PointEx(2);
    var p1: PointEx = PointEx(y: 9, x: 3);

    if (p0.x != 2 || p0.y != 5) { return 1; }
    if (p1.x != 3 || p1.y != 9) { return 2; }
    return 0;
}
//=== END

//=== CASE 114_static_method_default_and_named_args
struct CalcEx {
}

impl CalcEx {
    public static func add(a: u64, b: u64 = 40) -> u64 {
        return a + b;
    }
}

func main() -> u64 {
    var v0: u64 = CalcEx.add(2);
    var v1: u64 = CalcEx.add(b: 39, a: 3);
    if (v0 != 42) { return 1; }
    if (v1 != 42) { return 2; }
    return 0;
}
//=== END

//=== CASE 127_function_decorator_runtime_behavior
func add_one(next: u64, x: u64) -> u64 {
    return next(x) + 1;
}

@[add_one]
func decorated_double(x: u64) -> u64 {
    return x * 2;
}

func main() -> u64 {
    if (decorated_double(20) != 41) { return 1; }
    if (decorated_double(0) != 1) { return 2; }
    return 0;
}
//=== END

//=== CASE 128_entry_annotation_changes_program_entry
func main() -> u64 {
    return 77;
}

@[entry]
func runtime_entry() -> u64 {
    return 0;
}
//=== END

//=== CASE 132_match_multi_value_case_success
func classify_many(v: u64) -> u64 {
    match (v) {
        case 1, 2, 3:
            return 10;
        case 4, 5:
            return 20;
        case _:
            return 99;
    }
}

func main() -> u64 {
    if (classify_many(1) != 10) { return 1; }
    if (classify_many(3) != 10) { return 2; }
    if (classify_many(5) != 20) { return 3; }
    if (classify_many(9) != 99) { return 4; }
    return 0;
}
//=== END

//=== CASE 138_match_expression_with_capture_success
func main() -> u64 {
    var base: u64 = 40;
    var x: u64 = 2;
    var y: u64 = match (x) {
        case 1:
            base + 1;
        case 2, 3:
            base + x;
        case _:
            0;
    };

    if (y != 42) { return 1; }
    return 0;
}
//=== END

//=== CASE 139_function_type_signature_success
struct FuncBox {
    public cb: func (u64) -> u64;
}

func plus_one(v: u64) -> u64 {
    return v + 1;
}

func apply_once(cb: func (u64) -> u64, x: u64) -> u64 {
    return cb(x);
}

func apply_many(cb: func (u64, ...u64) -> u64) -> u64 {
    return cb(10, 20, 30);
}

func sum_head(head: u64, ...rest: u64) -> u64 {
    return head + rest;
}

func main() -> u64 {
    var f: func (u64) -> u64 = plus_one;
    if (f(41) != 42) { return 1; }

    var box: FuncBox = FuncBox { f };
    if (box.cb(41) != 42) { return 2; }

    if (apply_once(f, 41) != 42) { return 3; }

    var vf: func (u64, ...u64) -> u64 = sum_head;
    if (apply_many(vf) != 30) { return 4; }
    return 0;
}
//=== END

//=== CASE 140_try_catch_typed_value_success
func main() -> u64 {
    var out: i64 = 0;
    try {
        throw (i64)42;
    } catch (e: i64) {
        out = e;
    }
    if (out != 42) { return 1; }
    return 0;
}
//=== END

//=== CASE 133_throw_nested_loop_try_success
func main() -> u64 {
    var x: u64 = 0;
    try {
        var i: u64 = 0;
        while (i < 3) {
            var j: u64 = 0;
            while (j < 3) {
                x = x + 1;
                if (i == 1 && j == 1) {
                    throw 99;
                }
                j = j + 1;
            }
            x = x + 100;
            i = i + 1;
        }
        x = x + 10000;
    } catch {
        x = x + 7;
    } finally {
        x = x + 1000;
    }

    if (x != 1112) { return 1; }
    return 0;
}
//=== END

//=== CASE 134_instance_method_named_args_success
struct NamedArgsBox {
    public v: u64;
}

impl NamedArgsBox {
    public func set(self: *NamedArgsBox, a: u64, b: u64 = 10, c: u64 = 1) -> u64 {
        self.v = a + b + c;
        return self.v;
    }
}

func main() -> u64 {
    var b: NamedArgsBox = NamedArgsBox { 0 };
    var r0: u64 = b.set(1, 10, 1);
    var r1: u64 = b.set(c: 2, a: 3, b: 4);
    var r2: u64 = b.set(a: 5, c: 6);

    if (r0 != 12) { return 1; }
    if (r1 != 9) { return 2; }
    if (r2 != 21) { return 3; }
    return 0;
}
//=== END

//=== CASE 135_array_copy_init_success
func main() -> u64 {
    var src: [3]u64;
    src[0] = 10;
    src[1] = 20;
    src[2] = 30;

    var dst: [3]u64 = src;
    if (dst[0] != 10 || dst[1] != 20 || dst[2] != 30) { return 1; }

    src[1] = 99;
    if (dst[1] != 20) { return 2; }
    return 0;
}
//=== END

//=== CASE 136_mixed_float_int_binary_success
func main() -> u64 {
    var a: f64 = 1.5 + 2;
    var b: f64 = 10 - 0.5;
    var c: f64 = 3 * 2.0;
    var d: f64 = 9.0 / 2;

    if (a != 3.5) { return 1; }
    if (b != 9.5) { return 2; }
    if (c != 6.0) { return 3; }
    if (d != 4.5) { return 4; }

    if ((2 + 0.25) != 2.25) { return 5; }
    if ((3.0 > 2) == 0) { return 6; }
    if ((3 < 3.5) == 0) { return 7; }
    return 0;
}
//=== END

//=== CASE 137_generic_function_decorator_success
func plus_one(next: u64, x: u64) -> u64 {
    return next(x) + 1;
}

@[plus_one]
func decorated_twice<T>(x: T) -> T {
    return x + x;
}

func main() -> u64 {
    var v: u64 = decorated_twice<u64>(20);
    if (v != 41) { return 1; }
    return 0;
}
//=== END
