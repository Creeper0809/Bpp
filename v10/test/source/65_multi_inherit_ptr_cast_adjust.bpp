// Covers: multi-inheritance pointer upcast adjustment and argument-time auto-upcast
// Expect exit code: 0

struct Left {
    public l: u64;
}

struct Right {
    public r: u64;
}

struct Child : Left, Right {
    public c: u64;
}

impl Right {
    public func read(self: *Right) -> u64 {
        return self.r;
    }
}

impl Child {
    public func sum(self: *Child) -> u64 {
        return self.l + self.r + self.c;
    }
}

func read_left(p: *Left) -> u64 {
    return p.l;
}

func read_right(p: *Right) -> u64 {
    return p.r;
}

func main() -> u64 {
    var x: Child;
    x.l = 10;
    x.r = 20;
    x.c = 30;

    // Upcast to non-first parent must adjust pointer by parent offset.
    var rp: *Right = (*Right)&x;
    if (rp.r != 20) { return 1; }
    if (rp.read() != 20) { return 2; }

    var lp: *Left = (*Left)&x;
    if (lp.l != 10) { return 3; }

    // Direct child pointer remains valid.
    if (x.sum() != 60) { return 4; }

    // argument-time upcast checks
    var cp: *Child = &x;
    if (read_left(cp) != 10) { return 5; }
    if (read_right(cp) != 20) { return 6; }

    return 0;
}
