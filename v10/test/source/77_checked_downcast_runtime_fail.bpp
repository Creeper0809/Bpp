// Covers: checked downcast trap when casting parent pointer to wrong derived type
// Expect exit code: 132

struct ShapeCast {
    public bias: i64;
}

struct RectCast : ShapeCast {
    public w: i64;
    public h: i64;
}

struct CircleCast : ShapeCast {
    public r: i64;
}

impl ShapeCast {
    public abst func area(self: *ShapeCast) -> i64;
}

impl RectCast {
    @[override]
    public func area(self: *RectCast) -> i64 {
        return self.w * self.h + self.bias;
    }
}

impl CircleCast {
    @[override]
    public func area(self: *CircleCast) -> i64 {
        return self.r * self.r + self.bias;
    }
}

func main() -> i64 {
    var r: RectCast;
    r.bias = 1;
    r.w = 3;
    r.h = 4;

    var up: *ShapeCast = (*ShapeCast)&r;
    var wrong: *CircleCast = (*CircleCast)up; // should trap via checked cast guard
    return wrong.area();
}
