// Covers: new/delete + constructor/destructor + no-constructor struct + complex flow
// Expect exit code: 0

var g_sum: i64 = 0;

struct Node {
    id: i64;
}

struct Plain {
    a: u64;
}

impl Node {
    constructor() {
        self->id = self->id + 10;
    }

    destructor {
        g_sum = g_sum + self->id;
    }
}

func main(argc, argv) -> i64 {
    // Import

    // Setup
    var p: *Node = new Node{123}();
    var q: *Node = new Node{7}();
    var r: *Plain = new Plain{7};

    // Execution
    if (p->id != 133) { return 1; }
    if (q->id != 17) { return 2; }
    if (r->a != 7) { return 3; }

    for (var i: i64 = 0; i < 3; i = i + 1) {
        q->id = q->id + i;
    }

    var mix: i64 = p->id + q->id;
    if (mix != 153) { return 4; }
    if (q->id < 20) { return 5; }
    if (q->id > 20) { return 6; }

    delete p;
    delete q;
    delete r;

    // Assertion
    if (g_sum != 153) { return 7; }
    return 0;
}
