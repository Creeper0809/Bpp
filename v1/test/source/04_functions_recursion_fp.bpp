// Covers: functions, recursion, forward call, function pointer (stress)
// Expect exit code: 0

func add(a: i64, b: i64) -> i64 {
    return a + b;
}

func fib(n: i64) -> i64 {
    if (n <= 1) { return n; }
    return fib(n - 1) + fib(n - 2);
}

func forward_sum(a: i64, b: i64) -> i64;

func main(argc, argv) -> i64 {
    // Import

    // Setup
    var fp: u64 = &add;
    var stress_sum: i64 = 0;

    // Execution
    var direct: i64 = add(7, 8);
    if (direct != 15) { return 1; }

    var via_ptr: i64 = fp(9, 1);
    if (via_ptr != 10) { return 2; }

    var recur: i64 = fib(6);
    if (recur != 8) { return 3; }

    var forward: i64 = forward_sum(20, 22);
    if (forward != 42) { return 4; }

    // Stress: 반복 함수 포인터 호출
    for (var i: i64 = 0; i < 1000; i = i + 1) {
        stress_sum = stress_sum + fp(1, 2);
    }
    if (stress_sum != 3000) { return 5; }

    // Stress: 재귀 깊이 확인
    var recur_big: i64 = fib(10);
    if (recur_big != 55) { return 6; }

    // Assertion
    return 0;
}

func forward_sum(a: i64, b: i64) -> i64 {
    return a + b;
}
