// Covers: generics explicit/infer, multiple params, pointer generics (stress)
// Expect exit code: 0

func id<T>(x: T) -> T { return x; }

func add_pair<T, U>(a: T, b: U) -> i64 {
    return a + b;
}

func pass_ptr<T>(p: *T) -> *T { return p; }

func pass_pp<T>(p: **T) -> **T { return p; }

func main(argc, argv) -> i64 {
    // Import

    // Setup
    var a: i64 = 10;
    var b: i64 = 32;
    var sum_ids: i64 = 0;

    // Execution
    var v0: i64 = id<i64>(42);
    if (v0 != 42) { return 1; }

    var v1: i64 = id(7);
    if (v1 != 7) { return 2; }

    var sum: i64 = add_pair<i64, i64>(a, b);
    if (sum != 42) { return 3; }

    var ptr: *i64 = &a;
    var out_ptr: *i64 = pass_ptr<i64>(ptr);
    if (*out_ptr != 10) { return 4; }

    var ptr2: **i64 = &ptr;
    var out_ptr2: **i64 = pass_pp<i64>(ptr2);
    if (**out_ptr2 != 10) { return 5; }
    
    // Stress: 반복 제네릭 호출
    for (var i: i64 = 0; i < 100; i = i + 1) {
        sum_ids = sum_ids + id<i64>(i);
    }
    if (sum_ids != 4950) { return 6; }

    // Assertion
    return 0;
}
