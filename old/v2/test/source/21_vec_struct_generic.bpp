// Covers: Vec<T> storing struct values (sizeof(T) stride)
// Mode: ssa|nossa
// Opt: O0|O1
// Expect exit code: 0

import std.vec;

struct Point {
    x: u64;
    y: u64;
}

func main() -> u64 {
    // Setup
    if (sizeof(Point) != 16) { return 10; }
    var v: *Vec<Point> = (*Vec<Point>)Vec.new<Point>(4);

    var p0: Point;
    p0.x = 11;
    p0.y = 22;

    var p1: Point;
    p1.x = 33;
    p1.y = 44;

    // Execution
    v->push(p0);
    v->push(p1);

    // Assertion
    if (v->len() != 2) { return 1; }

    var base: u64 = v->data_ptr;
    var p0x: u64 = *(*u64)(base + 0);
    var p0y: u64 = *(*u64)(base + 8);
    var p1x: u64 = *(*u64)(base + sizeof(Point) + 0);
    var p1y: u64 = *(*u64)(base + sizeof(Point) + 8);

    if (p0x != 11) { return 2; }
    if (p0y != 22) { return 3; }
    if (p1x != 33) { return 4; }
    if (p1y != 44) { return 5; }

    return 0;
}
