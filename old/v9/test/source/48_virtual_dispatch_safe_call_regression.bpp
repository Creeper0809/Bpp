// Covers: virtual dispatch + safe method call on parent pointers including null short-circuit
// Expect exit code: 0

struct Shape {
    public bias: i64;
}

struct Rect : Shape {
    public w: i64;
    public h: i64;
}

impl Shape {
    public abst func area(self: *Shape) -> i64;
}

impl Rect {
    public func area(self: *Rect) -> i64 {
        return self.w * self.h + self.bias;
    }
}

func main() -> i64 {
    var r: Rect;
    r.bias = 1;
    r.w = 3;
    r.h = 4;

    var sp: *Shape = (*Shape)&r;
    if (sp.area() != 13) { return 1; }
    if (sp.?area() != 13) { return 2; }

    var null_sp: *Shape = 0;
    if (null_sp.?area() != 0) { return 3; }

    return 0;
}
