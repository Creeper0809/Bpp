// Covers: struct pointer cast adjustment across multi-inheritance layout
// Expect exit code: 0

struct Left {
    public l: u64;
}

struct Right {
    public r: u64;
}

struct Child : Left, Right {
    public c: u64;
}

impl Right {
    public func read(self: *Right) -> u64 {
        return self.r;
    }
}

impl Child {
    public func sum(self: *Child) -> u64 {
        return self.l + self.r + self.c;
    }
}

func main() -> u64 {
    var x: Child;
    x.l = 10;
    x.r = 20;
    x.c = 30;

    // Upcast to non-first parent must adjust pointer by parent offset.
    var rp: *Right = (*Right)&x;
    if (rp.r != 20) { return 1; }
    if (rp.read() != 20) { return 2; }

    var lp: *Left = (*Left)&x;
    if (lp.l != 10) { return 3; }

    // Downcast from parent pointer should reverse the offset adjustment.
    var cp: *Child = (*Child)rp;
    if (cp.c != 30) { return 4; }
    if (cp.sum() != 60) { return 5; }

    return 0;
}
