// Covers: stack constructor in args/returns/assignment with small+large structs
// Expect exit code: 0

struct Pair {
    a: u64;
    b: u64;
}

struct Triple {
    a: u64;
    b: u64;
    c: u64;
}

impl Pair {
    constructor(a: u64, b: u64) {
        self.a = a;
        self.b = b;
    }
}

impl Triple {
    constructor(a: u64, b: u64, c: u64) {
        self.a = a;
        self.b = b;
        self.c = c;
    }
}

func make_pair(base: u64) -> Pair {
    return Pair(base, base + 1);
}

func make_triple(base: u64) -> Triple {
    return Triple(base, base + 1, base + 2);
}

func sum_pair(p: Pair) -> u64 {
    return p.a + p.b;
}

func sum_triple(t: Triple) -> u64 {
    return t.a + t.b + t.c;
}

func mix(p: Pair, t: Triple) -> u64 {
    return p.a + p.b + t.a + t.b + t.c;
}

func main() -> u64 {
    // Import

    // Setup
    var p0: Pair = Pair(10, 20);
    var t0: Triple = Triple(1, 2, 3);
    var p1: Pair = make_pair(100);
    var t1: Triple = make_triple(200);
    var acc: u64 = 0;

    // Execution
    acc = acc + sum_pair(Pair(3, 4));
    acc = acc + sum_triple(Triple(5, 6, 7));
    acc = acc + mix(Pair(1, 2), Triple(3, 4, 5));

    p0 = Pair(11, 22);
    t0 = Triple(7, 8, 9);

    var p2: Pair = make_pair(7);
    var t2: Triple = make_triple(9);
    var m2: u64 = mix(p2, t2);

    // Assertion
    if (p0.a != 11 || p0.b != 22) { return 10; }
    if (t0.a != 7 || t0.b != 8 || t0.c != 9) { return 11; }
    if (p1.a != 100 || p1.b != 101) { return 12; }
    if (t1.a != 200 || t1.b != 201 || t1.c != 202) { return 13; }
    if (acc != 40) { return 20; }
    if (m2 != 45) { return 21; }
    return 0;
}
