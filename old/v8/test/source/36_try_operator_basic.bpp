// Covers: try operator propagation for Option/Result
// Mode: ssa|nossa
// Opt: O0|O1
// Expect exit code: 0

import std.option;
import std.result;

func opt_inc(x: Option<u64>) -> Option<u64> {
    var v: u64 = x?;
    return Option_some<u64>(v + 1);
}

func res_inc(x: Result<u64, u64>) -> Result<u64, u64> {
    var v: u64 = x?;
    return Result_ok<u64, u64>(v + 1);
}

func main() -> u64 {
    // Import

    // Setup
    var ok_opt: Option<u64> = Option_some<u64>(41);
    var none_opt: Option<u64> = Option_none<u64>();
    var ok_res: Result<u64, u64> = Result_ok<u64, u64>(41);
    var err_res: Result<u64, u64> = Result_err<u64, u64>(7);

    // Execution
    var o1: Option<u64> = opt_inc(ok_opt);
    if (o1.is_some() == 0) { return 1; }
    if (o1.unwrap() != 42) { return 2; }

    var o2: Option<u64> = opt_inc(none_opt);
    if (o2.is_none() == 0) { return 3; }

    var r1: Result<u64, u64> = res_inc(ok_res);
    if (r1.is_ok() == 0) { return 4; }
    if (r1.unwrap() != 42) { return 5; }

    var r2: Result<u64, u64> = res_inc(err_res);
    if (r2.is_err() == 0) { return 6; }
    if (r2.unwrap_err() != 7) { return 7; }

    // Assertion
    return 0;
}
