// Covers: impl static methods, static factory, static pure helper, mixed instance calls (stress)
// Expect exit code: 0

struct Counter {
    value: i64;
}

impl Counter {
    static func make(v: i64) -> Counter {
        var c: Counter;
        c.value = v;
        return c;
    }

    static func add(a: i64, b: i64) -> i64 {
        return a + b;
    }

    static func mix(a: i64, b: i64) -> i64 {
        if ((a & 1) == 0) { return a + b; }
        return a - b;
    }

    func inc(self: *Counter, delta: i64) {
        self->value = self->value + delta;
    }

    func get(self: *Counter) -> i64 {
        return self->value;
    }
}

func main(argc, argv) -> i64 {
    // Import

    // Setup
    // Static factory creates a value instance without an implicit receiver.
    var counter: Counter = Counter.make(10);
    // Static helper computes expected sums without touching instance state.
    var expected: i64 = Counter.add(10, 5);

    // Execution
    counter.inc(5);
    if (counter.get() != expected) { return 1; }

    // Stress: 반복 정적 함수 호출 + 인스턴스 업데이트
    for (var i: i64 = 0; i < 1000; i = i + 1) {
        var step: i64 = Counter.add(1, 0);
        counter.inc(step);
    }
    if (counter.get() != expected + 1000) { return 2; }

    // Complex: static mix + instance updates
    var acc: i64 = 0;
    for (var j: i64 = 0; j < 12; j = j + 1) {
        var step2: i64 = Counter.mix(j, 3);
        if ((j % 4) == 0) {
            counter.inc(step2);
        } else {
            counter.inc(step2 + 1);
        }
        acc = acc + counter.get();
    }
    if (counter.get() != 1090) { return 3; }
    if (acc != 12538) { return 4; }

    // Assertion
    return 0;
}
