// Covers: inline asm basic move (stress)
// Expect exit code: 0

func asm_get_constant() -> i64 {
    var asm_result: i64 = 0;
    asm {
        mov rax, 7
        mov [rbp-8], rax
    }
    return asm_result;
}

func main(argc, argv) -> i64 {
    // Import

    // Setup
    var v: i64 = 0;
    var sum: i64 = 0;

    // Execution
    v = asm_get_constant();
    if (v != 7) { return 1; }

    // Stress: 반복 인라인 asm 호출
    for (var i: i64 = 0; i < 1000; i = i + 1) {
        sum = sum + asm_get_constant();
    }
    if (sum != 7000) { return 2; }

    // Complex: branch-dependent aggregation with asm values
    var complex_sum: i64 = 0;
    var flip: i64 = 0;
    for (var k: i64 = 0; k < 20; k = k + 1) {
        var v0: i64 = asm_get_constant();
        if ((k & 3) == 0) {
            complex_sum = complex_sum + v0;
        } else {
            complex_sum = complex_sum - (v0 - 3);
        }
        if ((k == 7) || (k == 13)) { flip = flip ^ 1; }
        if (flip == 1) { complex_sum = complex_sum + 1; }
    }
    if (complex_sum != -19) { return 3; }

    // Assertion
    return 0;
}
