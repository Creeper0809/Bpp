// Covers: HashMap grow/rehash with many keys
// Mode: ssa|nossa
// Opt: O0|O1
// Expect exit code: 0

import std.hashmap;

func main() -> u64 {
    // Import

    // Setup
    var map: *HashMap<u64, u64> = (*HashMap<u64, u64>)new HashMap<u64, u64>(1);

    var k00: u64 = "k00";
    var k01: u64 = "k01";
    var k02: u64 = "k02";
    var k03: u64 = "k03";
    var k04: u64 = "k04";
    var k05: u64 = "k05";
    var k06: u64 = "k06";
    var k07: u64 = "k07";
    var k08: u64 = "k08";
    var k09: u64 = "k09";
    var k10: u64 = "k10";
    var k11: u64 = "k11";
    var k12: u64 = "k12";
    var k13: u64 = "k13";
    var k14: u64 = "k14";
    var k15: u64 = "k15";
    var k16: u64 = "k16";
    var k17: u64 = "k17";
    var k18: u64 = "k18";
    var k19: u64 = "k19";

    // Execution
    map->put(k00, 3, 1000);
    map->put(k01, 3, 1001);
    map->put(k02, 3, 1002);
    map->put(k03, 3, 1003);
    map->put(k04, 3, 1004);
    map->put(k05, 3, 1005);
    map->put(k06, 3, 1006);
    map->put(k07, 3, 1007);
    map->put(k08, 3, 1008);
    map->put(k09, 3, 1009);
    map->put(k10, 3, 1010);
    map->put(k11, 3, 1011);
    map->put(k12, 3, 1012);
    map->put(k13, 3, 1013);
    map->put(k14, 3, 1014);
    map->put(k15, 3, 1015);
    map->put(k16, 3, 1016);
    map->put(k17, 3, 1017);
    map->put(k18, 3, 1018);
    map->put(k19, 3, 1019);

    if (map->get(k00, 3) != 1000) { return 1; }
    if (map->get(k01, 3) != 1001) { return 2; }
    if (map->get(k02, 3) != 1002) { return 3; }
    if (map->get(k03, 3) != 1003) { return 4; }
    if (map->get(k04, 3) != 1004) { return 5; }
    if (map->get(k05, 3) != 1005) { return 6; }
    if (map->get(k06, 3) != 1006) { return 7; }
    if (map->get(k07, 3) != 1007) { return 8; }
    if (map->get(k08, 3) != 1008) { return 9; }
    if (map->get(k09, 3) != 1009) { return 10; }
    if (map->get(k10, 3) != 1010) { return 11; }
    if (map->get(k11, 3) != 1011) { return 12; }
    if (map->get(k12, 3) != 1012) { return 13; }
    if (map->get(k13, 3) != 1013) { return 14; }
    if (map->get(k14, 3) != 1014) { return 15; }
    if (map->get(k15, 3) != 1015) { return 16; }
    if (map->get(k16, 3) != 1016) { return 17; }
    if (map->get(k17, 3) != 1017) { return 18; }
    if (map->get(k18, 3) != 1018) { return 19; }
    if (map->get(k19, 3) != 1019) { return 20; }

    // Assertion
    return 0;
}
