// Covers: HashMap struct value storage (byte-wise copy)
// Mode: ssa|nossa
// Opt: O0|O1
// Expect exit code: 0

import std.hashmap;

struct Pair {
    a: u64;
    b: u64;
}

func main() -> u64 {
    // Import

    // Setup
    var map: *HashMap<u64, Pair> = (*HashMap<u64, Pair>)new HashMap<u64, Pair>(2);
    var k1: u64 = "p1";
    var k2: u64 = "p2";

    var v1: Pair;
    v1.a = 11;
    v1.b = 22;

    var nested: *HashMap<u64, HashMap<u64, Pair>> = 0;

    var v2: Pair;
    v2.a = 33;
    v2.b = 44;

    // Execution
    map->put(k1, 2, v1);
    map->put(k2, 2, v2);

    var r1: Pair = map->get(k1, 2);
    if (r1.a != 11) { return 1; }
    if (r1.b != 22) { return 2; }

    var r2: Pair = map->get(k2, 2);
    if (r2.a != 33) { return 3; }
    if (r2.b != 44) { return 4; }

    var v3: Pair;
    v3.a = 55;
    v3.b = 66;
    map->put(k1, 2, v3);

    var r3: Pair = map->get(k1, 2);
    if (r3.a != 55) { return 5; }
    if (r3.b != 66) { return 6; }

    // Assertion
    return 0;
}
