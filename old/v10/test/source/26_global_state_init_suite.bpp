// Covers: global variables + global struct/generic literal init (old 26, 27)
// Mode: ssa|nossa
// Opt: O0|O1
// Expect exit code: 0

struct PairA {
    public a: u32;
    public b: u64;
}

struct PairB {
    public a: u64;
    public b: u16;
    public c: u8;
}

struct BoxG<T> {
    public value: T;
    public weight: u64;
}

const BASE = 9;

var g_u8: u8 = 1;
var g_u16: u16 = 2;
var g_u32: u32 = 3;
var g_u64: u64 = 4;
var g_i64: i64 = 5;
var g_ptr: *u8;
var g_arr: [4]u16;
var g_slice: []u8;
var g_pair_a: PairA = PairA { 7, 1000 };

var g_pair_b1: PairB = PairB { 40, 2, 3 };
var g_pair_b2: PairB = PairB { BASE, 1, 1 };
var g_box: BoxG<u64> = BoxG<u64> { 7, 100 };

func main() -> u64 {
    var buf: [8]u8;
    for (var i: u64 = 0; i < 8; i++) {
        buf[i] = (u8)(10 + i);
    }

    g_arr[0] = 10;
    g_arr[1] = 20;
    g_arr[2] = 30;
    g_arr[3] = 40;

    g_ptr = &buf[3];
    *g_ptr = 42;

    var local_slice: []u8 = slice(&buf[2], 4);
    g_slice = local_slice;

    var total0: u64 = 0;
    total0 = total0 + (u64)g_u8;
    total0 = total0 + (u64)g_u16;
    total0 = total0 + (u64)g_u32;
    total0 = total0 + g_u64;
    total0 = total0 + (u64)g_i64;
    total0 = total0 + (u64)g_arr[0];
    total0 = total0 + (u64)g_arr[1];
    total0 = total0 + (u64)g_pair_a.a;
    total0 = total0 + g_pair_a.b;
    total0 = total0 + (u64)g_slice[0];
    total0 = total0 + (u64)g_slice[1];
    total0 = total0 + (u64)g_slice[3];
    if (total0 != 1121) { return 1; }

    var total1: u64 = 0;
    total1 = total1 + g_pair_b1.a + (u64)g_pair_b1.b + (u64)g_pair_b1.c;
    total1 = total1 + g_pair_b2.a + (u64)g_pair_b2.b + (u64)g_pair_b2.c;
    total1 = total1 + g_box.value + g_box.weight;
    if (total1 != 163) { return 2; }

    // Corner: global literals and mutable globals interaction.
    if (g_pair_b2.a != BASE) { return 3; }

    var garr_ptr: *u16 = &g_arr[2];
    *garr_ptr = 33;
    if (g_arr[2] != 33) { return 4; }

    g_box.value = g_box.value + g_pair_b2.a;
    g_box.weight = g_box.weight + (u64)g_pair_b1.c;
    if (g_box.value != 16) { return 5; }
    if (g_box.weight != 103) { return 6; }

    var total2: u64 = 0;
    total2 = total2 + (u64)g_arr[0] + (u64)g_arr[1] + (u64)g_arr[2] + (u64)g_arr[3];
    total2 = total2 + g_box.value + g_box.weight;
    if (total2 != 222) { return 7; }

    g_slice[2] = 77;
    if (buf[4] != 77) { return 8; }

    *g_ptr = 55;
    if (g_slice[1] != 55) { return 9; }

    return 0;
}
