// Covers: private method shadowing across inheritance with abstract virtual dispatch in same hierarchy
// Expect exit code: 0

struct Parent {
    v: i64;
}

struct Child : Parent {
    x: i64;
}

impl Parent {
    private func local(self: *Parent) -> i64 {
        return 100;
    }

    public abst func calc(self: *Parent) -> i64;

    public func call_local(self: *Parent) -> i64 {
        return self.local();
    }

    public func call_calc(self: *Parent) -> i64 {
        return self.calc();
    }
}

impl Child {
    private func local(self: *Child) -> i64 {
        return 200;
    }

    public func calc(self: *Child) -> i64 {
        return self.local() + self.v + self.x;
    }

    public func child_local(self: *Child) -> i64 {
        return self.local();
    }
}

func main() -> i64 {
    var c: Child;
    c.v = 1;
    c.x = 2;

    if (c.child_local() != 200) { return 1; }
    if (c.calc() != 203) { return 2; }

    var p: *Parent = (*Parent)&c;
    if (p.call_local() != 100) { return 3; } // Parent private method call must stay static
    if (p.call_calc() != 203) { return 4; }  // abstract path must dispatch to Child.calc

    return 0;
}
