// Covers: HashMap basic/grow/struct-value scenarios (old 23,24,25)
// Mode: ssa|nossa
// Opt: O0|O1
// Expect exit code: 0

import std.hashmap;

struct PairMap {
    public a: u64;
    public b: u64;
}

func main() -> u64 {
    var map0: *HashMap<u64, u64> = (*HashMap<u64, u64>)new HashMap<u64, u64>(2);
    var k1: u64 = "a";
    var k2: u64 = "bb";
    var k3: u64 = "ccc";
    var k4: u64 = "dddd";
    var k_missing: u64 = "zz";

    map0.put(k1, 1, 10);
    map0.put(k2, 2, 20);
    map0.put(k3, 3, 30);
    map0.put(k4, 4, 40);

    if (map0.has(k1, 1) == 0) { return 1; }
    if (map0.has(k2, 2) == 0) { return 2; }
    if (map0.has(k3, 3) == 0) { return 3; }
    if (map0.has(k4, 4) == 0) { return 4; }

    if (map0.get(k1, 1) != 10) { return 5; }
    if (map0.get(k2, 2) != 20) { return 6; }
    if (map0.get(k3, 3) != 30) { return 7; }
    if (map0.get(k4, 4) != 40) { return 8; }

    map0.put(k2, 2, 222);
    if (map0.get(k2, 2) != 222) { return 9; }

    if (map0.has(k_missing, 2) != 0) { return 10; }
    if (map0.get(k_missing, 2) != 0) { return 11; }

    var map1: *HashMap<u64, u64> = (*HashMap<u64, u64>)new HashMap<u64, u64>(1);

    var k00: u64 = "k00";
    var k01: u64 = "k01";
    var k02: u64 = "k02";
    var k03: u64 = "k03";
    var k04: u64 = "k04";
    var k05: u64 = "k05";
    var k06: u64 = "k06";
    var k07: u64 = "k07";
    var k08: u64 = "k08";
    var k09: u64 = "k09";
    var k10: u64 = "k10";
    var k11: u64 = "k11";
    var k12: u64 = "k12";
    var k13: u64 = "k13";
    var k14: u64 = "k14";
    var k15: u64 = "k15";
    var k16: u64 = "k16";
    var k17: u64 = "k17";
    var k18: u64 = "k18";
    var k19: u64 = "k19";

    map1.put(k00, 3, 1000);
    map1.put(k01, 3, 1001);
    map1.put(k02, 3, 1002);
    map1.put(k03, 3, 1003);
    map1.put(k04, 3, 1004);
    map1.put(k05, 3, 1005);
    map1.put(k06, 3, 1006);
    map1.put(k07, 3, 1007);
    map1.put(k08, 3, 1008);
    map1.put(k09, 3, 1009);
    map1.put(k10, 3, 1010);
    map1.put(k11, 3, 1011);
    map1.put(k12, 3, 1012);
    map1.put(k13, 3, 1013);
    map1.put(k14, 3, 1014);
    map1.put(k15, 3, 1015);
    map1.put(k16, 3, 1016);
    map1.put(k17, 3, 1017);
    map1.put(k18, 3, 1018);
    map1.put(k19, 3, 1019);

    if (map1.get(k00, 3) != 1000) { return 101; }
    if (map1.get(k01, 3) != 1001) { return 102; }
    if (map1.get(k02, 3) != 1002) { return 103; }
    if (map1.get(k03, 3) != 1003) { return 104; }
    if (map1.get(k04, 3) != 1004) { return 105; }
    if (map1.get(k05, 3) != 1005) { return 106; }
    if (map1.get(k06, 3) != 1006) { return 107; }
    if (map1.get(k07, 3) != 1007) { return 108; }
    if (map1.get(k08, 3) != 1008) { return 109; }
    if (map1.get(k09, 3) != 1009) { return 110; }
    if (map1.get(k10, 3) != 1010) { return 111; }
    if (map1.get(k11, 3) != 1011) { return 112; }
    if (map1.get(k12, 3) != 1012) { return 113; }
    if (map1.get(k13, 3) != 1013) { return 114; }
    if (map1.get(k14, 3) != 1014) { return 115; }
    if (map1.get(k15, 3) != 1015) { return 116; }
    if (map1.get(k16, 3) != 1016) { return 117; }
    if (map1.get(k17, 3) != 1017) { return 118; }
    if (map1.get(k18, 3) != 1018) { return 119; }
    if (map1.get(k19, 3) != 1019) { return 120; }

    var map2: *HashMap<u64, PairMap> = (*HashMap<u64, PairMap>)new HashMap<u64, PairMap>(2);
    var p1k: u64 = "p1";
    var p2k: u64 = "p2";

    var v1: PairMap;
    v1.a = 11;
    v1.b = 22;

    var v2: PairMap;
    v2.a = 33;
    v2.b = 44;

    map2.put(p1k, 2, v1);
    map2.put(p2k, 2, v2);

    var r1: PairMap = map2.get(p1k, 2);
    if (r1.a != 11 || r1.b != 22) { return 201; }

    var r2: PairMap = map2.get(p2k, 2);
    if (r2.a != 33 || r2.b != 44) { return 202; }

    var v3: PairMap;
    v3.a = 55;
    v3.b = 66;
    map2.put(p1k, 2, v3);

    var r3: PairMap = map2.get(p1k, 2);
    if (r3.a != 55 || r3.b != 66) { return 203; }

    return 0;
}
