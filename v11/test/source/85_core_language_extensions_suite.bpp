// Covers: core language extensions success suite

//=== CASE 108_bool_and_signed_int_primitives
func main() -> u64 {
    var b_true: bool = true;
    var b_false: bool = false;
    var x8: i8 = (i8)120;
    var x16: i16 = (i16)30000;
    var x32: i32 = (i32)2000000000;

    if (b_true == 0) { return 1; }
    if (b_false != 0) { return 2; }
    if ((i64)x8 != 120) { return 3; }
    if ((i64)x16 != 30000) { return 4; }
    if ((i64)x32 != 2000000000) { return 5; }

    return 0;
}
//=== END

//=== CASE 124_annotation_on_function_and_variable_decls
@[config]
var G_ANNOTATED: u64 = 40;

struct AnnBox {
}

impl AnnBox {
    @[trace]
    public static func add(a: u64, b: u64) -> u64 {
        return a + b;
    }
}

@[feature]
func sum_with_annotation(a: u64, b: u64) -> u64 {
    @[hot]
    var local_sum: u64 = a + b;
    return local_sum;
}

func main() -> u64 {
    var out: u64 = sum_with_annotation(G_ANNOTATED, 2);
    if (out != 42) { return 1; }
    if (AnnBox.add(1, 1) != 2) { return 2; }
    return 0;
}
//=== END

//=== CASE 109_default_named_and_variadic_direct_call
func add3(a: u64, b: u64 = 7, c: u64 = 11) -> u64 {
    return a + b + c;
}

func variadic_head_sum(head: u64, ...rest: u64) -> u64 {
    return head + rest;
}

func main() -> u64 {
    var a: u64 = add3(1);
    var b: u64 = add3(1, c: 100, b: 10);
    var c: u64 = add3(a: 5, c: 1);

    if (a != 19) { return 10; }
    if (b != 111) { return 11; }
    if (c != 13) { return 12; }

    var v0: u64 = variadic_head_sum(9);
    var v1: u64 = variadic_head_sum(9, 4);
    var v2: u64 = variadic_head_sum(9, 4, 88, 99);

    if (v0 != 9) { return 20; }
    if (v1 != 13) { return 21; }
    if (v2 != 13) { return 22; }

    return 0;
}
//=== END

//=== CASE 110_lambda_non_capture_success
func main() -> u64 {
    var f: u64 = func (x: u64) -> u64 { x + 2 };
    var g: u64 = func (x: u64, y: u64) -> u64 { x * y };

    var a: u64 = f(40);
    var b: u64 = g(6, 7);

    if (a != 42) { return 1; }
    if (b != 42) { return 2; }
    return 0;
}
//=== END

//=== CASE 111_match_alias_with_wildcard
func classify(v: u64) -> u64 {
    match (v) {
        case 1:
            return 10;
        case 2:
            return 20;
        case _:
            return 99;
    }
}

func main() -> u64 {
    if (classify(1) != 10) { return 1; }
    if (classify(2) != 20) { return 2; }
    if (classify(777) != 99) { return 3; }
    return 0;
}
//=== END

//=== CASE 112_try_catch_finally_throw_success
func main() -> u64 {
    var x: u64 = 0;
    try {
        x = x + 1;
        throw 123;
        x = x + 100;
    } catch {
        x = x + 10;
    } finally {
        x = x + 1000;
    }

    if (x != 1011) { return 1; }
    return 0;
}
//=== END

//=== CASE 113_constructor_default_and_named_args
struct PointEx {
    public x: u64;
    public y: u64;
}

impl PointEx {
    public constructor(x: u64, y: u64 = 5) {
        self.x = x;
        self.y = y;
    }
}

func main() -> u64 {
    var p0: PointEx = PointEx(2);
    var p1: PointEx = PointEx(y: 9, x: 3);

    if (p0.x != 2 || p0.y != 5) { return 1; }
    if (p1.x != 3 || p1.y != 9) { return 2; }
    return 0;
}
//=== END

//=== CASE 114_static_method_default_and_named_args
struct CalcEx {
}

impl CalcEx {
    public static func add(a: u64, b: u64 = 40) -> u64 {
        return a + b;
    }
}

func main() -> u64 {
    var v0: u64 = CalcEx.add(2);
    var v1: u64 = CalcEx.add(b: 39, a: 3);
    if (v0 != 42) { return 1; }
    if (v1 != 42) { return 2; }
    return 0;
}
//=== END

//=== CASE 127_function_decorator_runtime_behavior
func add_one(next: u64, x: u64) -> u64 {
    return next(x) + 1;
}

@[add_one]
func decorated_double(x: u64) -> u64 {
    return x * 2;
}

func main() -> u64 {
    if (decorated_double(20) != 41) { return 1; }
    if (decorated_double(0) != 1) { return 2; }
    return 0;
}
//=== END

//=== CASE 128_entry_annotation_changes_program_entry
func main() -> u64 {
    return 77;
}

@[entry]
func runtime_entry() -> u64 {
    return 0;
}
//=== END
